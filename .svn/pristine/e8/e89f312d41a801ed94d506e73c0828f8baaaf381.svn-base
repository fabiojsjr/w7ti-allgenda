package com.tetrasoft.common.fila;

import java.util.HashMap;
import java.util.Map;

/**
 * Para usar N Filas
 * @author davi.mesquita davimesquita@gmail.com
 */
public class InvokeNStack {
	private Map<Integer,InvokeQueueStack> stack = new HashMap<Integer,InvokeQueueStack>();
	private int nfila=1;
	public InvokeNStack(int nfilas) {
		if (nfilas==0)
			throw new ExceptionInInitializerError("Fila Zerada");
		for (int i=1;i<=nfilas;i++) {
			this.stack.put(i, new InvokeQueueStack(this.getClass().getSimpleName()));
		}
	}
	
	public void add(Runnable th) {
		InvokeQueueStack st=null;
		synchronized (this.stack) {
			st = this.stack.get(this.nfila++);
			if (st==null) {
				this.nfila=1;
				st = this.stack.get(this.nfila++);
			}
		}
		try {
			if (st==null)
				throw new Exception("Erro na delegacao de fila");
			st.add(th);
		} catch (Exception e) {
			System.err.println(e.getMessage());
			new Thread(th).start();
		}
	}
	
	public void stop() {
		synchronized (this.stack) {
			for (InvokeQueueStack th: this.stack.values()) {
				try {
					th.stopQueue();
				} catch (Exception e) {
//					e.printStackTrace();
				}
			}
		}
	}
}
