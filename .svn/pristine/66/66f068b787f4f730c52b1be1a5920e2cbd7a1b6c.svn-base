<!DOCTYPE html>
<%@page import="com.technique.engine.util.ExceptionWarning"%>
<%@page import="com.tetrasoft.data.usuario.LogEntity"%>
<%@page import="com.tetrasoft.data.cliente.TaskEntity"%>
<%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%>

<%@ include file="logado.jsp" %>
<%@ include file="idioma.jsp" %>
<%@ include file="methods.jsp" %>

<%
	Connection conn = null;

	try {
		
		conn = usuarioLogado.retrieveConnection();
		
		String idCalendario = request.getParameter("idCalendario");
		if( idCalendario == null ) idCalendario = "0";
		
		if( request.getParameter("done") != null ) { // conclusao de task
			String tipo   = request.getParameter("tipo");
			String id     = request.getParameter("id");
			String status = request.getParameter("status");
			
			TaskEntity task = new TaskEntity();
			task.done( id, status, conn );
			new LogEntity( LogEntity.TIPO_SITE, usuarioLogado.getIdUsuario(), task.getTableName(), task.get_IDFieldName(), request.getRemoteAddr(), request.getLocalName(), new Long(id), "Task modificada: " + status, conn);
		}
	
		if( request.getParameter("change") != null ) {
			String id   = request.getParameter("id");
			String data = request.getParameter("data");
			
			long date = Date.parse(data);
			
			TaskEntity task = new TaskEntity();
			task.update( id.replaceAll("\\|task",""), new Date(date), conn );
			new LogEntity( LogEntity.TIPO_SITE, usuarioLogado.getIdUsuario(), task.getTableName(), task.get_IDFieldName(), request.getRemoteAddr(), request.getLocalName(), task.getIdTask(), "Task alterada data", conn);
		}
	
	
		if( request.getParameter("save") != null ) {
			String titulo = request.getParameter("titulo");
			String data   = request.getParameter("data");
			
			long date = Date.parse(data);
			
			TaskEntity task = new TaskEntity();
			task.save( usuarioLogado.getIdUsuario(), titulo, new Date(date), conn );
			new LogEntity( LogEntity.TIPO_SITE, usuarioLogado.getIdUsuario(), task.getTableName(), task.get_IDFieldName(), request.getRemoteAddr(), request.getLocalName(), task.getIdTask(), "Task criada", conn);
		}
%>


<div id="dashboard-left" class="span8">
	<!div class="alert alert-error">

	<h4 class="widgettitle">
		<%= p.get("AgendaTarefas") %>
		
		<%	if( usuarioLogado.getIdPerfil().longValue() == 1l || usuarioLogado.getIdPerfil().longValue() == 2l ) { // admins %>
				<div style="float:right; margin-top: -5px; margin-right: -10px">
					
				</div>
		<%	} %>  
	
	</h4>
	<div class="widgetcontent font1" style="text-align: justify;">
		<%@ include file="calendario.jsp" %>
	</div>
</div><!--span6-->
  	
<div id="dashboard-left" class="span4" id="cantoDireitoMiolo">
	<h4 class="widgettitle">TO-DO</h4>
	<div class="widgetcontent">
		<%@ include file="to-do.jsp" %>
		<!--  
		<img src="http://ichart.yahoo.com/b?s=^bvsp" width="100%"></img>									
		-->
	</div>
</div>

<style>
	.fc-event-time{
		display: none;
	}
</style>


<%	
	} catch( Exception ex ) {
		ex.printStackTrace();
	} finally {
		conn.close();
	}
%>